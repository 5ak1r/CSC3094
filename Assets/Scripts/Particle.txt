using UnityEngine;

public struct Particle : MonoBehaviour {
    public int ID;
    public Vector3 velocity;
    public Vector3 force;

    public void Start() {
        force = new Vector3(Random.Range(0, 10), ParticleManager.GRAVITY, Random.Range(0, 10));
    }

    public void Update() {
        float deltaTime = Time.deltaTime;

        velocity += force * deltaTime;
        transform.position += velocity * deltaTime - 0.5f * Mathf.Pow(deltaTime, 2) * force;

        ResolveCollisions();

        ParticleManager.positions[ID] = transform.position;
    }

    private void ResolveCollisions() {
        int walls = ParticleManager.BOX_SIZE;
        
        if(transform.position.y <= 0.0f) {
            Vector3 pos = transform.position;
            pos.y = 0.0f;
            transform.position = pos;

            velocity.y *= -0.9f;

            if(Mathf.Abs(velocity.y) < 0.1f) velocity.y = 0.0f;
        }

        if (Mathf.Abs(transform.position.x) >= walls) {
            Vector3 pos = transform.position;
            pos.x = (transform.position.x > 0.0f) ? walls : -walls;
            transform.position = pos;

            velocity.x *= -0.9f;
        }

        if (Mathf.Abs(transform.position.z) >= walls) {
            Vector3 pos = transform.position;
            pos.z = (transform.position.z > 0.0f) ? walls : -walls;
            transform.position = pos;

            velocity.z *= -0.9f;
        }
    }
}